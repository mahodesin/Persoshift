<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>PersoShift ETF‑Rechner</title>

  <!-- Schrift & Chart.js -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body{font-family:'Inter',sans-serif;text-align:center;padding:2rem;max-width:800px;margin:auto;}
    h1{font-size:2.2rem;margin-bottom:1rem;}
    section{margin-bottom:2rem;text-align:left;}
    label{display:block;margin:0.5rem 0;font-size:1rem;}
    input, button{font-family:inherit;font-size:1rem;padding:0.5rem;border:1px solid #ccc;border-radius:6px;width:100%;box-sizing:border-box;}
    .row{display:flex;gap:0.5rem;}
    .btn{background:#5146ff;color:#fff;font-weight:600;border:none;cursor:pointer;border-radius:6px;margin:0.5rem 0;}
    .btn:hover{background:#3e37d8;}
    #advToggle{cursor:pointer;margin:1rem 0;font-weight:600;color:#5146ff;}
    #advanced{display:none;border:1px dashed #bbb;padding:1rem;border-radius:6px;}
    #warn{color:#c00;font-size:0.9rem;}
    canvas{width:100%!important;height:500px!important;margin-bottom:2rem;}
  </style>
</head>
<body>

<h1>PersoShift ETF‑Rechner</h1>

<section>
  <label>Monatsrate (€)
    <input id="rate" type="number" value="50" min="0">
  </label>
  <label>Laufzeit (Jahre)
    <input id="years" type="number" value="15" min="1">
  </label>
  <label>Jahresrendite (%)
    <input id="interest" type="number" value="7" step="0.1" min="0">
  </label>

  <div id="advToggle">Erweiterte Optionen ▼</div>
  <div id="advanced">
    <label>Startkapital (€)
      <input id="start" type="number" value="0" min="0">
    </label>
    <div class="row">
      <label style="flex:1">Einmalzahlung (€)
        <input id="lumpsum" type="number" value="0" min="0">
      </label>
      <label style="flex:1">im Jahr
        <input id="lumpyear" type="number" value="1" min="1">
      </label>
    </div>
  </div>

  <button class="btn" onclick="calc(false)">Berechnen (Brutto)</button>
  <button class="btn" onclick="calc(true)">Berechnen (mit Steuer)</button>
  <div id="warn"></div>
</section>

<h2 id="headline"></h2>
<canvas id="chart"></canvas>

<h3>Vergleich (Endkapital)</h3>
<canvas id="compare"></canvas>

<script>
const taxRate=0.26375; // 26,375 % Kapitalertragsteuer
// Elemente
const rateEl=document.getElementById('rate'), yearsEl=document.getElementById('years'),
      intEl=document.getElementById('interest'), startEl=document.getElementById('start'),
      lumpEl=document.getElementById('lumpsum'), lumpYearEl=document.getElementById('lumpyear'),
      warnEl=document.getElementById('warn'), headlineEl=document.getElementById('headline');
let chartMain, chartCompare;

// Dropdown
const advToggle=document.getElementById('advToggle'), advBox=document.getElementById('advanced');
advToggle.onclick=()=>{
  const open=advBox.style.display==='block';
  advBox.style.display=open?'none':'block';
  advToggle.textContent=open?'Erweiterte Optionen ▼':'Erweiterte Optionen ▲';
};

// Formatierung
function fmt(n){return n.toLocaleString('de-DE',{style:'currency',currency:'EUR',maximumFractionDigits:0});}

function calc(withTax){
  // Werte lesen
  const rate=+rateEl.value||0,
        yrs=+yearsEl.value||0,
        pYear=(+intEl.value||0)/100,
        start=+startEl.value||0,
        lump=+lumpEl.value||0,
        lumpY=+lumpYearEl.value||0;
  warnEl.textContent='';
  if(yrs<1){warnEl.textContent='Bitte Laufzeit ≥ 1 eingeben';return;}
  if(lump>0 && (lumpY<1||lumpY>yrs)){warnEl.textContent='Einmalzahlung außerhalb Laufzeit';return;}

  // Arrays füllen
  const labels=[], depCum=[], netCum=[], taxCum=[];
  let value=start, paidCum=start;
  for(let y=1;y<=yrs;y++){
    // Einmalzahlung zu Jahresbeginn
    if(y===lumpY) paidCum+=lump, value+=lump;
    // Monatsweiser Aufbau
    for(let m=0;m<12;m++){
      value*=1+pYear/12;
      value+=rate;
      paidCum+= (m===11?rate:0);
    }
    const gross=value-paidCum;
    const tax=withTax?gross*taxRate:0;
    const net=gross-tax;
    labels.push('Jahr '+y);
    depCum.push(paidCum);
    taxCum.push(tax);
    netCum.push(net);
  }

  // Headline
  const endCap=value, profit=endCap-paidCum;
  headlineEl.textContent=`Endkapital: ${fmt(endCap)}   Einzahlungen: ${fmt(paidCum)}   Gewinn: ${fmt(profit)}`;

  // Chart zeichnen
  if(chartMain) chartMain.destroy();
  chartMain=new Chart(document.getElementById('chart'),{
    type:'bar',
    data:{labels,datasets:[
      {label:'Einzahlung (kumuliert)',data:depCum,backgroundColor:'rgba(101,115,255,0.7)',stack:'all'},
      {label:'Gewinn (netto kumuliert)',data:netCum,backgroundColor:'rgba(46,204,113,0.7)',stack:'all'},
      {label:'Steuer kumuliert',data:taxCum,backgroundColor:'rgba(231,76,60,0.7)',stack:'all'}
    ]},
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{position:'bottom',labels:{font:{size:16}}}},
      scales:{
        y:{beginAtZero:true,ticks:{font:{size:16},stepSize:50000,callback:v=>v.toLocaleString('de-DE')}},
        x:{ticks:{font:{size:14}}}
      }
    }
  });

  // Vergleich
  if(chartCompare) chartCompare.destroy();
  const bank0=paidCum,
        tages=paidCum*Math.pow(1+0.02,yrs);
  chartCompare=new Chart(document.getElementById('compare'),{
    type:'bar',
    data:{labels:['ETF','Bank 0%','Tagesgeld 2%'],datasets:[{data:[endCap,bank0,tages],
      backgroundColor:['rgba(46,204,113,0.7)','rgba(149,165,166,0.7)','rgba(52,152,219,0.7)']}]
    },
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true,ticks:{font:{size:16},stepSize:50000,callback:v=>v.toLocaleString('de-DE')}},
             x:{ticks:{font:{size:14}}}}
    }
  });
}
</script>

</body>
</html>
