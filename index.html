<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>PersoShift ETF‑Rechner</title>
    <!-- Schrift & Chart.js -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body{font-family:'Inter',sans-serif;text-align:center;padding:2rem;max-width:900px;margin:auto}
      h1{font-size:2rem;margin-bottom:1.5rem}
      label{font-weight:600}
      input,button{font-size:1rem;padding:.4rem .6rem;width:100%;box-sizing:border-box;margin-top:.2rem}
      button{background:#2563eb;color:#fff;border:none;border-radius:4px;cursor:pointer;margin-top:.8rem}
      button:hover{background:#1d4ed8}
      #result{margin-top:1rem;font-size:1.1rem;font-weight:600}
      canvas{max-width:800px;margin:2rem auto}
    </style>
  </head>
  <body>
    <h1>PersoShift ETF‑Rechner</h1>

    <section id="calc" style="text-align:left">
      <label>Monatsrate (€)
        <input id="rate" type="number" value="50" min="1">
      </label><br><br>

      <label>Laufzeit (Jahre)
        <input id="years" type="number" value="15" min="1">
      </label><br><br>

      <label>Jahresrendite (%)
        <input id="interest" type="number" value="7" step="0.1" min="0">
      </label><br><br>

      <button onclick="calc()">Berechnen</button>

      <div id="result"></div>
    </section>

    <canvas id="chart"></canvas>

    <script>
      const TAX_RATE = 0.26375; // dt. Abgeltungsteuer inkl. Soli, ohne KiSt
      let myChart;

      function calc(){
        const rate   = parseFloat(document.getElementById('rate').value);
        const years  = parseInt(document.getElementById('years').value);
        const pA     = parseFloat(document.getElementById('interest').value)/100;
        const pM     = pA/12;
        const months = years*12;

        // Endwert der Sparrate
        const endCap = rate * ( (Math.pow(1+pM, months) - 1) / pM );
        const deposits = rate * months;
        const grossProfit = endCap - deposits;
        const tax = grossProfit * TAX_RATE;
        const netProfit = grossProfit - tax;

        document.getElementById('result').innerHTML =
          `Endkapital: <b>${fmt(endCap)}</b><br>`+
          `Einzahlungen: ${fmt(deposits)}<br>`+
          `Brutto‑Gewinn: ${fmt(grossProfit)}<br>`+
          `Steuer (26,38 %): –${fmt(tax)}<br>`+
          `Netto‑Gewinn: <b>${fmt(netProfit)}</b>`;

        // Jahreswerte für Chart
        const labels = [];
        const depositArr = [];
        const netArr = [];
        const taxArr = [];
        let value = 0;
        let gainCum = 0;
        let taxCum = 0;
        for(let y=1;y<=years;y++){
          for(let m=0;m<12;m++){
            value = value*(1+pM)+rate;
          }
          const depY = rate*12;
          const grossY = value - deposits; // kumuliert
          const profitY = grossY - gainCum; // Gewinn dieses Jahres
          const taxY = profitY*TAX_RATE;
          const netY = profitY - taxY;
          gainCum += profitY;
          taxCum += taxY;

          labels.push('Jahr '+y);
          depositArr.push(depY);
          netArr.push(netY);
          taxArr.push(taxY);
        }

        drawChart(labels, depositArr, netArr, taxArr);
      }

      function drawChart(labels, dep, net, tax){
        if(myChart) myChart.destroy();
        const ctx = document.getElementById('chart').getContext('2d');
        myChart = new Chart(ctx, {
          type:'bar',
          data:{
            labels:labels,
            datasets:[
              {label:'Einzahlung',data:dep,backgroundColor:'#93c5fd'},
              {label:'Netto‑Gewinn',data:net,backgroundColor:'#4ade80'},
              {label:'Steuer',data:tax,backgroundColor:'#fca5a5'}
            ]
          },
          options:{
            responsive:true,
            plugins:{legend:{position:'bottom'}},
            scales:{y:{beginAtZero:true,stacked:true},x:{stacked:true}}
          }
        });
      }

      function fmt(num){
        return num.toLocaleString('de-DE',{style:'currency',currency:'EUR',maximumFractionDigits:0});
      }
    </script>
  </body>
</html>
